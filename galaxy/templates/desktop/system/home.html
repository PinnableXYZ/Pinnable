{% extends 'desktop/common/layout0.html' %}
{% block content %}
<div class="box">
<h1>Welcome to Pinnable</h1>
<section>

{% if account %}
<p>Welcome back, {{ account.address }}</p>
<div class="flex-one-row">
<a href="/websites" class="btn">
  <img src="{{ static_url("img/network.svg") }}" height="16" />
  <span>Manage My Websites</span>
</a>
<a href="#;" onclick="signout()" class="btn">
  <span>Sign Out</span>
</a>
</div>
{% else %}
<p>We are building open-source software and infrastructure for pinning decentralized websites running on IPFS and ENS.</p>

<a href="javascript:doSIWE();" class="svg-btn"><img src="{{ static_url("img/siwe.svg") }}" border="0" alt="Sign in with Ethereum" class="btn-siwe" /></a>
<form method="post" action="/auth" id="siwe-form">
  <input type="hidden" name="signature" id="siwe-signature" value="">
  <input type="hidden" name="message" id="siwe-message" value="">
  {{ xsrf_form_html()|safe }}
</form>
{% endif %}
</section>
</div>

<div class="box">
<h2>What is Pinning?</h2>
<section>
<p>When you create and publish decentralized websites using the Planet app, your Mac serves as a node on the IPFS peer-to-peer network, hosting your sites. By utilizing pinning, additional copies of your websites are distributed across the entire network, resulting in quicker loading times and increased accessibility. For laptop users, this eliminates the need to keep your laptop on as a server. Each time you publish new content, Pinnable initiates syncing with your node, ensuring that you don't have to keep your Mac on continuously as a server.</p>

<p>You will always maintain control over the authoritative version of your content.</p>
</section>
</div>

{% include 'desktop/common/juicebox.html' %}
{% endblock %}
{% block aside %}
<div class="box">
<h2 class="aside">Latest Blog Posts from Planetable.eth</h2>
<div class="blog-items">
</div>
<script type="text/javascript">
const blogFeed = "https://planetable.eth.limo/planet.json";

// js function to format Swift timestamp to human-readable date
function formatDate(timestamp) {
  const date = new Date((timestamp + 978307200) * 1000);
  const shortDate = new Intl.DateTimeFormat("en", {
    dateStyle: "medium",
  });
  const formattedDateString = shortDate.format(date);
  return formattedDateString;
}

// Fetch blog feed and iterate over feed['articles']
// Only show 5 most recent posts
fetch(blogFeed)
  .then(response => response.json())
  .then(data => {
    console.log(data);
    const blogItems = document.querySelector('.blog-items');
    data['articles'].slice(0, 5).forEach(article => {
      const blogItem = document.createElement('a');
      blogItem.classList.add('blog-item');
      blogItem.href = `https://planetable.eth.limo/${article['id']}/`;
      blogItem.target = '_blank';
      blogItem.innerHTML = `
        <div class="blog-title">${article['title']}</div>
        <div class="blog-date">${formatDate(article['created'])}</div>
      `;
      blogItems.appendChild(blogItem);
    });
  });
</script>
</div>
{% endblock %}
